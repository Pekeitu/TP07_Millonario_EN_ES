<body onload="modalPreexistente()">
    <!-- Modal para comprobar si el jugador ya existia previamente, y confirmar si se quiere recargar el usuario o empezar de cero -->
    <div class="modal" tabindex="-1" role="dialog" id="Preexistente">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Notificacion</h5>
                </div>
                <div class="modal-body">
                    <p>Se ha encontrado un jugador que previamente tenia el mismo nombre. Desea mantener los datos precargados o prefiere reiniciar la partida?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Mantener actual</button>
                    <button type="button" class="btn btn-secondary" onclick="ReiniciarJugador()" data-bs-dismiss="modal">Reiniciar partida</button>
                </div>
            </div>
        </div>
    </div>

    <img class="position-absolute fixed-top start-0 vw-100 vh-100" style="z-index: -1;" id="fondo" src="https://fotografias.antena3.com/clipping/cmsimages02/2020/01/10/ABE9B428-C9D0-4676-80E0-D1E512848828/57.jpg">

    <div id="LogoYPregunta" class="vh-100 d-inline-flex flex-column justify-content-center align-items-center">
        <img class="w-50 h-auto" style="margin-top: -5%" id="logoQQSM" src="/image/QQSMLogo.png">
        
        <!-- Pregunta -->
        <div id="TextoPregunta" class="pt-1 pb-1 pl-2 pr-2 mt-3 mb-3 text-center rounded-pill">
            @ViewBag.Pregunta.txtPregunta
        </div>

        <!-- Respuestas -->
        <div class="row">
            @for(int i = 0; i < @ViewBag.Respuestas.Count; i++)
            {
                @if(i > 0 && (i % 2) == 0)
                {
                    <div class="w-100 mb-1"></div>
                }

                <div class="d-flex col justify-content-center">
                    <button id="opcionRespuesta-@i" class="w-100 btn btn-info text-center" value=@ViewBag.Respuestas[i].opcionRespuesta onclick="checkRespuesta(this.value)">
                        @ViewBag.Respuestas[i].opcionRespuesta. @ViewBag.Respuestas[i].txtRespuesta
                    </button>
                </div>
            }
        </div>
    </div>

    <div class="vh-100 d-inline-flex flex-column justify-content-center align-items-center float-right bg-transparent">
        @for(int i = 0; i < @ViewBag.ListaPozo.Count; i++)
        {
            @if(i < @ViewBag.PosPozo)
            {
                <div id="entradaPozo-@i" value=@ViewBag.ListaPozo[i].valorSeguro class="container bg-success rounded-pill mb-1 text-center">
                    @ViewBag.ListaPozo[i].importe
                </div>
            } else if(@ViewBag.ListaPozo[i].valorSeguro) {
                <div id="entradaPozo-@i" value=@ViewBag.ListaPozo[i].valorSeguro class="container bg-warning rounded-pill mb-1 text-center">
                    @ViewBag.ListaPozo[i].importe
                </div>
            } else {
                <div id="entradaPozo-@i" value=@ViewBag.ListaPozo[i].valorSeguro class="container bg-info rounded-pill mb-1 text-center">
                    @ViewBag.ListaPozo[i].importe
                </div>
            }
        }
    </div>

    <script>
        function modalPreexistente()
        {
            var Preexistente = '@ViewBag.preexistente';
            if(Preexistente == "False") return;

            var myModal = new bootstrap.Modal(document.getElementById('Preexistente'), {
                keyboard: false
            });

            myModal.show();
        }

        function ReiniciarJugador()
        {
            //AJAX al action ReiniciarJugador
            $.ajax({
                type: 'POST',
                dataType: "JSON",
                url: '@Url.Action("ReiniciarJugador", "Home")',
                data: { },
                success:
                    function () {
                    }
            })
        }

        function checkRespuesta(value)
        {
            //AJAX al action comprobarRespuesta
            $.ajax({
                type: 'POST',
                dataType: "JSON",
                url: '@Url.Action("comprobarRespuesta", "Home")',
                data: { Opcion: value },
                success:
                    function (data) {
                        if(data)
                        {
                            $.ajax({
                                type: 'POST',
                                dataType: "JSON",
                                url: '@Url.Action("CargarSiguientePreguntaAjax", "Home")',
                                data: { },
                                success:
                                    function (response) {
                                        document.getElementById('TextoPregunta').innerText = response.pregunta.txtPregunta;

                                        //Randomizar el orden de las respuestas porque... porque no?
                                        shuffle(response.respuestas);
                                        for(var i = 0; i < response.respuestas.length; i++)
                                        {
                                            var search = "opcionRespuesta-".concat(i.toString());
                                            document.getElementById(search).innerHTML = String.fromCharCode(65 + i) + ". " + response.respuestas[i].txtRespuesta;
                                            document.getElementById(search).value = response.respuestas[i].opcionRespuesta;
                                        }
                                    }
                            })
                        } else {
                            alert("SOS TREMENDO PETE");
                            return;
                        }
                    }
            })
        }

        //Creditos: https://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array
        function shuffle(a) {
            var j, x, i;
            for (i = a.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                x = a[i];
                a[i] = a[j];
                a[j] = x;
            }
            return a;
        }
    </script>
</body>